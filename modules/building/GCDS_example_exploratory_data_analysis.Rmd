---
title: "GCDS: EDA Example"
#author: "gcook"
#date: "`r Sys.Date()`"
output: 
  html_document: 
    toc: yes
    number_sections: yes
    highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
rm(list = ls(all.names = TRUE))

# load externals
source("https://pastebin.com/raw/b63hB7Hj")

# a better view function
view <- function(object, rows = F, show = 100, ...) { 
    get_Packages(c("DT", "tibble"), load = F) # check if library is installed
    # check appropriateness of data structure
  if (tibble::is_tibble(object)) {
    object = as.data.frame(object)
  }  
  if (is.null(dim(object)) & class(object) == "list") {
        message("Object is a list. Viewer displays last list element. Consider passing each element to view().")
        lapply(object, function(x) { 
          DT::datatable(x, 
                        rownames = rows, 
                        options = list(pageLength = show),
                        filter = "top") }) 
    } else {
        DT::datatable(object, 
                      rownames = rows, 
                      options = list(pageLength = show),
                      filter = "top") 
    }
}

# some objects to work with
this_rmd_path = rstudioapi::getActiveDocumentContext()$path
proj_name = ""
proj_dir <- gsub("r/.*.Rmd","", this_rmd_path)
r_dir <- paste0(proj_dir, "r/")
data_dir <- paste0(proj_dir, "data/")
```

Load libraries.   

```{r message=FALSE, warning=FALSE}
# load some libraries
library(tidyverse)
library(magrittr)
library(GGally)
library(DataExplorer)
```




```{r message=FALSE, warning=FALSE}
DAT <- read_csv(paste0(data_dir, "psa001_agg.csv")) # face data

DAT2 <- read_csv(paste0(data_dir, "pets.csv"))   # pet data also at DSRR

BG <- read_csv(paste0(data_dir,"Games_Survey_numeric_gcook_cleaned.csv"))
```


View data in html? 

```{r}
# uses the function defined at the top of the file
view(BG, show = 10)
```


```{r message=FALSE, warning=FALSE, include=FALSE}
DAT <- DAT %>% 
  # create new variables based on characters
  mutate(sex  = ifelse(grepl("F", stim_id), "Female", "Male"), # using ifelse()
         race = case_when(grepl("B", stim_id) ~ "Black",       # easier using dplyr::case_when()
                          grepl("A", stim_id) ~ "Asian",
                          grepl("W", stim_id) ~ "White",
                          grepl("L", stim_id) ~ "Latino"
                          )
  ) %>%
  # dplyr::select(stim_id, attractive, caring, intelligent, mean, unhappy) %>%
  select(-stim_id) %>%                                # remove 1 ,  - means subtract out
  select(-c(responsible, sociable, weird, emostable)) # remove multiple, -c()
```


**Using `DataExplorer` library for plotting bar for factor variables**

```{r}
DAT2 %>%
  DataExplorer::plot_bar()
```

**Using `DataExplorer` library for plotting density plots for numeric variables**

```{r}
DAT %>%
  select(-region) %>%
  plot_density(.)


BG %>%
  select(c("Taboo", "Catan", "gender", starts_with("mechan"))) %>%
  select(1:13) %>%
  plot_density(.)
```


**Using `DataExplorer` library for plotting some correlation matrices**


```{r}
DAT %>%
  select(-c(region, sex, race)) %>%
  plot_correlation(.)
```


Too many variables, so reduce to the first 10 game mechanics.

```{r}
BG2 <- BG %>%
  select(c("Taboo", "Catan", "gender", starts_with("mechanic")))
  
names(BG2) <- gsub("mechanic-", "", names(BG2) )

BG2 %>%
  select(1:10) %>%
  plot_correlation(.)
```


**Using `DataExplorer` library for some dimension reduction**

```{r}
DAT %>%
  select(-c(region, sex, race)) %>%
  plot_prcomp(.)


BG2 %>%
  select(-starts_with("chara")) %>%
  plot_prcomp(.)
```



**Using `GGally` library to plot variable pairs** 

Because there are many variables in the data set, we will have to remove some so the plots render better.

Look how easy in three lines of code? Exploring data in this way helps narrow down potential models to explore. 

```{r message=FALSE, warning=FALSE}
# change plot size (optional)
#options(repr.plot.width = 20, repr.plot.height = 10)

DAT %>% 
  select("sex", "aggressive", "confident", "mean", "trustworthy", "race") %>%
  ggpairs(mapping = aes(color = .data[["sex"]], alpha = 0.5))
```

Explore some mechanic relationships but color mapping needs to be a factor, so change gender to factor.

```{r}
BG2 %>%
  select(c(4, 5, 7, 9, 11, 12, 24, 26, 34, 35, 38)) %>%
  ggpairs() 

BG2 %>%
  mutate(gender = as.factor(gender)) %>%
  select(c("gender", 4, 5, 7, 9, 11, 12, 24, 26, 34)) %>%
  ggpairs(mapping = aes(color = .data[["gender"]], alpha = 0.5))
```


Need fast exploration of pet data?

```{r message=FALSE, warning=FALSE}
DAT2 %>% 
  select(-c(id, country)) %>%
  ggpairs(mapping = aes(color = .data[["pet"]], alpha = 0.5))
```

